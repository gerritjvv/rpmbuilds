

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Sqoop Client API Guide &mdash; Apache Sqoop  documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="Apache Sqoop  documentation" href="index.html" /> 
  </head>
  <body>
      <div class="header"><img class="rightlogo" src="_static/sqoop-logo.png" alt="Logo"/><h1 class="heading"><a href="index.html">
          <span>Apache Sqoop  documentation</span></a></h1>
        <h2 class="heading"><span>Sqoop Client API Guide</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        <a class="uplink" href="index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="sqoop-client-api-guide">
<h1>Sqoop Client API Guide<a class="headerlink" href="#sqoop-client-api-guide" title="Permalink to this headline">¶</a></h1>
<p>This document will explain how to use Sqoop Client API with external application. Client API allows you to execute the functions of sqoop commands. It requires Sqoop Client JAR and its dependencies.</p>
<p>Client API is explained using Generic JDBC Connector properties. Before executing the application using the sqoop client API, check whether sqoop server is running.</p>
<div class="section" id="workflow">
<h2>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h2>
<p>Given workflow has to be followed for executing a job in Sqoop server.</p>
<blockquote>
<div><ol class="arabic simple">
<li>Create connection using Connector ID (cid) - Creates connection and returns connection ID (xid)</li>
<li>Create Job using Connection ID (xid)       - Create job and returns Job ID (jid)</li>
<li>Job submission with Job ID (jid)           - Submit sqoop Job to server</li>
</ol>
</div></blockquote>
</div>
<div class="section" id="project-dependencies">
<h2>Project Dependencies<a class="headerlink" href="#project-dependencies" title="Permalink to this headline">¶</a></h2>
<p>Here given maven dependency</p>
<div class="highlight-none"><div class="highlight"><pre>&lt;dependency&gt;
  &lt;groupId&gt;org.apache.sqoop&lt;/groupId&gt;
    &lt;artifactId&gt;sqoop-client&lt;/artifactId&gt;
    &lt;version&gt;${requestedVersion}&lt;/version&gt;
&lt;/dependency&gt;
</pre></div>
</div>
</div>
<div class="section" id="initialization">
<h2>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h2>
<p>First initialize the SqoopClient class with server URL as argument.</p>
<div class="highlight-none"><div class="highlight"><pre>String url = &quot;http://localhost:12000/sqoop/&quot;;
SqoopClient client = new SqoopClient(url);
</pre></div>
</div>
<p>Server URL value can be modfied by setting value to setServerUrl(String) method</p>
<div class="highlight-none"><div class="highlight"><pre>client.setServerUrl(newUrl);
</pre></div>
</div>
</div>
<div class="section" id="connection">
<h2>Connection<a class="headerlink" href="#connection" title="Permalink to this headline">¶</a></h2>
<p>Client API allows you to create, update and delete connection. For creating or updating connection requires Connector forms and Framwork Forms. User has to retrive the connector and framework forms, then update the values.</p>
<div class="section" id="create-connection">
<h3>Create Connection<a class="headerlink" href="#create-connection" title="Permalink to this headline">¶</a></h3>
<p>First create a new connection by invoking newConnection(cid) method with connector ID and returns a MConnection object with dummy id. Then fill the connection and framework forms as given below. Invoke create connection with updated connection object.</p>
<div class="highlight-none"><div class="highlight"><pre>//Dummy connection object
MConnection newCon = client.newConnection(1);

//Get connection and framework forms. Set name for connection
MConnectionForms conForms = newCon.getConnectorPart();
MConnectionForms frameworkForms = newCon.getFrameworkPart();
newCon.setName(&quot;MyConnection&quot;);

//Set connection forms values
conForms.getStringInput(&quot;connection.connectionString&quot;).setValue(&quot;jdbc:mysql://localhost/my&quot;);
conForms.getStringInput(&quot;connection.jdbcDriver&quot;).setValue(&quot;com.mysql.jdbc.Driver&quot;);
conForms.getStringInput(&quot;connection.username&quot;).setValue(&quot;root&quot;);
conForms.getStringInput(&quot;connection.password&quot;).setValue(&quot;root&quot;);

frameworkForms.getIntegerInput(&quot;security.maxConnections&quot;).setValue(0);

Status status  = client.createConnection(newCon);
if(status.canProceed()) {
 System.out.println(&quot;Created. New Connection ID : &quot; +newCon.getPersistenceId());
} else {
 System.out.println(&quot;Check for status and forms error &quot;);
}
</pre></div>
</div>
<p>status.canProceed() returns true if status is FINE or ACCEPTABLE. Above code has given status after validation of connector and framework forms.</p>
<p>On successful execution, new connection ID is assigned for the connection. getPersistenceId() method returns ID.
User can retrieve a connection using below methods</p>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">getConnection(xid)</span></tt></td>
<td>Returns a connection object.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">getConnections()</span></tt></td>
<td>Returns list of connection object</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="list-of-status-code">
<h3>List of status code<a class="headerlink" href="#list-of-status-code" title="Permalink to this headline">¶</a></h3>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Function</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">FINE</span></tt></td>
<td>There are no issues, no warnings.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">ACCEPTABLE</span></tt></td>
<td>Validated entity is correct enough to be processed. There might be some warnings, but no errors.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">UNACCEPTABLE</span></tt></td>
<td>There are serious issues with validated entity. We can&#8217;t proceed until reported issues will be resolved.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="view-error-or-warning-message">
<h3>View Error or Warning message<a class="headerlink" href="#view-error-or-warning-message" title="Permalink to this headline">¶</a></h3>
<p>In case of any UNACCEPTABLE AND ACCEPTABLE status, user has to iterate the connector part forms and framework part forms for getting actual error or warning message. Below piece of code describe how to itereate over the forms for input message.</p>
<div class="highlight-none"><div class="highlight"><pre>printMessage(newCon.getConnectorPart().getForms());
printMessage(newCon.getFrameworkPart().getForms());

private static void printMessage(List&lt;MForm&gt; formList) {
  for(MForm form : formList) {
    List&lt;MInput&lt;?&gt;&gt; inputlist = form.getInputs();
    if (form.getValidationMessage() != null) {
      System.out.println(&quot;Form message: &quot; + form.getValidationMessage());
    }
    for (MInput minput : inputlist) {
      if (minput.getValidationStatus() == Status.ACCEPTABLE) {
        System.out.println(&quot;Warning:&quot; + minput.getValidationMessage());
      } else if (minput.getValidationStatus() == Status.UNACCEPTABLE) {
        System.out.println(&quot;Error:&quot; + minput.getValidationMessage());
      }
    }
  }
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="job">
<h2>Job<a class="headerlink" href="#job" title="Permalink to this headline">¶</a></h2>
<p>A job object holds database configurations, input or output configurations and resources required for executing as a hadoop job. Create job object requires filling connector part and framework part forms.</p>
<p>Below given code shows how to create a import job</p>
<div class="highlight-none"><div class="highlight"><pre>String url = &quot;http://localhost:12000/sqoop/&quot;;
SqoopClient client = new SqoopClient(url);
//Creating dummy job object
MJob newjob = client.newJob(1, org.apache.sqoop.model.MJob.Type.IMPORT);
MJobForms connectorForm = newjob.getConnectorPart();
MJobForms frameworkForm = newjob.getFrameworkPart();

newjob.setName(&quot;ImportJob&quot;);
//Database configuration
connectorForm.getStringInput(&quot;table.schemaName&quot;).setValue(&quot;&quot;);
//Input either table name or sql
connectorForm.getStringInput(&quot;table.tableName&quot;).setValue(&quot;table&quot;);
//connectorForm.getStringInput(&quot;table.sql&quot;).setValue(&quot;select id,name from table where ${CONDITIONS}&quot;);
connectorForm.getStringInput(&quot;table.columns&quot;).setValue(&quot;id,name&quot;);
connectorForm.getStringInput(&quot;table.partitionColumn&quot;).setValue(&quot;id&quot;);
//Set boundary value only if required
//connectorForm.getStringInput(&quot;table.boundaryQuery&quot;).setValue(&quot;&quot;);

//Output configurations
frameworkForm.getEnumInput(&quot;output.storageType&quot;).setValue(&quot;HDFS&quot;);
frameworkForm.getEnumInput(&quot;output.outputFormat&quot;).setValue(&quot;TEXT_FILE&quot;);//Other option: SEQUENCE_FILE
frameworkForm.getStringInput(&quot;output.outputDirectory&quot;).setValue(&quot;/output&quot;);

//Job resources
frameworkForm.getIntegerInput(&quot;throttling.extractors&quot;).setValue(1);
frameworkForm.getIntegerInput(&quot;throttling.loaders&quot;).setValue(1);

Status status = client.createJob(newjob);
if(status.canProceed()) {
 System.out.println(&quot;New Job ID: &quot;+ newjob.getPersistenceId());
} else {
 System.out.println(&quot;Check for status and forms error &quot;);
}

//Print errors or warnings
printMessage(newjob.getConnectorPart().getForms());
printMessage(newjob.getFrameworkPart().getForms());
</pre></div>
</div>
<p>Export job creation is same as import job, but only few input configuration changes</p>
<div class="highlight-none"><div class="highlight"><pre>String url = &quot;http://localhost:12000/sqoop/&quot;;
SqoopClient client = new SqoopClient(url);
MJob newjob = client.newJob(1, org.apache.sqoop.model.MJob.Type.EXPORT);
MJobForms connectorForm = newjob.getConnectorPart();
MJobForms frameworkForm = newjob.getFrameworkPart();

newjob.setName(&quot;ExportJob&quot;);
//Database configuration
connectorForm.getStringInput(&quot;table.schemaName&quot;).setValue(&quot;&quot;);
//Input either table name or sql
connectorForm.getStringInput(&quot;table.tableName&quot;).setValue(&quot;table&quot;);
//connectorForm.getStringInput(&quot;table.sql&quot;).setValue(&quot;select id,name from table where ${CONDITIONS}&quot;);
connectorForm.getStringInput(&quot;table.columns&quot;).setValue(&quot;id,name&quot;);

//Input configurations
frameworkForm.getStringInput(&quot;input.inputDirectory&quot;).setValue(&quot;/input&quot;);

//Job resources
frameworkForm.getIntegerInput(&quot;throttling.extractors&quot;).setValue(1);
frameworkForm.getIntegerInput(&quot;throttling.loaders&quot;).setValue(1);

Status status = client.createJob(newjob);
if(status.canProceed()) {
  System.out.println(&quot;New Job ID: &quot;+ newjob.getPersistenceId());
} else {
  System.out.println(&quot;Check for status and forms error &quot;);
}

//Print errors or warnings
printMessage(newjob.getConnectorPart().getForms());
printMessage(newjob.getFrameworkPart().getForms());
</pre></div>
</div>
<div class="section" id="managing-connection-and-job">
<h3>Managing connection and job<a class="headerlink" href="#managing-connection-and-job" title="Permalink to this headline">¶</a></h3>
<p>After creating connection or job object, you can update or delete a connection or job using given functions</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">updateConnection(connection)</span></tt></td>
<td>Invoke update with connection object and check status for any errors or warnings</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">deleteConnection(xid)</span></tt></td>
<td>Delete connection. Deletes only if specified connection is used by any job</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">updateJob(job)</span></tt></td>
<td>Invoke update with job object and check status for any errors or warnings</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">deleteJob(jid)</span></tt></td>
<td>Delete job</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="job-submission">
<h2>Job Submission<a class="headerlink" href="#job-submission" title="Permalink to this headline">¶</a></h2>
<p>Job submission requires a job id. On successful submission, getStatus() method returns &#8220;BOOTING&#8221; or &#8220;RUNNING&#8221;.</p>
<div class="highlight-none"><div class="highlight"><pre>//Job submission start
MSubmission submission = client.startSubmission(1);
System.out.println(&quot;Status : &quot; + submission.getStatus());
if(submission.getStatus().isRunning() &amp;&amp; submission.getProgress() != -1) {
  System.out.println(&quot;Progress : &quot; + String.format(&quot;%.2f %%&quot;, submission.getProgress() * 100));
}
System.out.println(&quot;Hadoop job id :&quot; + submission.getExternalId());
System.out.println(&quot;Job link : &quot; + submission.getExternalLink());
Counters counters = submission.getCounters();
if(counters != null) {
  System.out.println(&quot;Counters:&quot;);
  for(CounterGroup group : counters) {
    System.out.print(&quot;\t&quot;);
    System.out.println(group.getName());
    for(Counter counter : group) {
      System.out.print(&quot;\t\t&quot;);
      System.out.print(counter.getName());
      System.out.print(&quot;: &quot;);
      System.out.println(counter.getValue());
    }
  }
}
if(submission.getExceptionInfo() != null) {
  System.out.println(&quot;Exception info : &quot; +submission.getExceptionInfo());
}


//Check job status
MSubmission submission = client.getSubmissionStatus(1);
if(submission.getStatus().isRunning() &amp;&amp; submission.getProgress() != -1) {
  System.out.println(&quot;Progress : &quot; + String.format(&quot;%.2f %%&quot;, submission.getProgress() * 100));
}

//Stop a running job
submission.stopSubmission(jid);
</pre></div>
</div>
</div>
<div class="section" id="describe-forms">
<h2>Describe Forms<a class="headerlink" href="#describe-forms" title="Permalink to this headline">¶</a></h2>
<p>You can view the connection or job forms input values with labels of built-in resource bundle.</p>
<div class="highlight-none"><div class="highlight"><pre>String url = &quot;http://localhost:12000/sqoop/&quot;;
SqoopClient client = new SqoopClient(url);
//Use getJob(jid) for describing job.
//While printing connection forms, pass connector id to getResourceBundle(cid).
describe(client.getConnection(1).getConnectorPart().getForms(), client.getResourceBundle(1));
describe(client.getConnection(1).getFrameworkPart().getForms(), client.getFrameworkResourceBundle());

void describe(List&lt;MForm&gt; forms, ResourceBundle resource) {
  for (MForm mf : forms) {
    System.out.println(resource.getString(mf.getLabelKey())+&quot;:&quot;);
    List&lt;MInput&lt;?&gt;&gt; mis = mf.getInputs();
    for (MInput mi : mis) {
      System.out.println(resource.getString(mi.getLabelKey()) + &quot; : &quot; + mi.getValue());
    }
    System.out.println();
  }
}
</pre></div>
</div>
<p>Above Sqoop 2 Client API tutorial explained you how to create connection, create job and submit job.</p>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        <a class="uplink" href="index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2009-2013 The Apache Software Foundation.
    </div>
  </body>
</html>